<!DOCTYPE html>
<html>
<head>
    <title>AI ATC Neural Agent</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; background: #0b132b; color: white; font-family: monospace; display: flex; height: 100vh; }
        #map { flex: 1; }
        #sidebar { width: 350px; background: #1c2541; display: flex; flex-direction: column; border-left: 2px solid #3a506b; }
        #flight-list { flex: 1; overflow-y: auto; padding: 10px; }
        .card { padding: 10px; margin-bottom: 5px; background: #0b132b; border-left: 5px solid; font-size: 11px; }
        .footer { padding: 10px; background: #1c2541; border-top: 1px solid #3a506b; }
        .btn-group { display: flex; flex-wrap: wrap; gap: 4px; }
        button { font-size: 9px; cursor: pointer; background: #3a506b; color: white; border: none; padding: 4px; border-radius: 2px; }
        #status-info { font-size: 10px; margin-top: 8px; color: #5dade2; height: 30px; }
        
        .red { border-color: #ff4d4d; } .green { border-color: #2ecc71; }
        .blue { border-color: #3498db; } .white { border-color: #ffffff; }
        .purple { border-color: #9b59b6; } .cyan { border-color: #1abc9c; }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="sidebar">
        <div style="padding:15px; background:#0b132b;">
            <h3 style="margin:0">AI ATC AGENT</h3>
            <div id="ap-focus" style="color:#00ffcc; font-size:12px">Neural Syncing...</div>
        </div>
        <div id="flight-list"></div>
        <div class="footer">
            <div class="btn-group">
                <button onclick="filter('all')">ALL</button>
                <button style="color:#ff4d4d" onclick="filter('red')">RISK</button>
                <button style="color:#2ecc71" onclick="filter('green')">LAND</button>
                <button style="color:#ffffff" onclick="filter('white')">DEPART</button>
                <button style="color:#3498db" onclick="filter('blue')">READY</button>
                <button style="color:#9b59b6" onclick="filter('purple')">TECH</button>
            </div>
            <div id="status-info">Click a category to filter the radar view.</div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const map = L.map('map', {zoomControl: false}).setView([0,0], 2);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);
        let allData = []; let layers = L.layerGroup().addTo(map);

        async function sync() {
            const r = await fetch('./data.json?v=' + Date.now());
            const d = await r.json();
            allData = d.aircraft;
            document.getElementById('ap-focus').innerText = `Focus: ${d.airport.name}`;
            map.panTo([d.airport.lat, d.airport.lon]);
            if(map.getZoom() < 10) map.setZoom(10);
            render(allData);
        }

        function render(flights) {
            layers.clearLayers();
            const list = document.getElementById('flight-list');
            list.innerHTML = '';
            flights.forEach(f => {
                L.circleMarker([f.lat, f.lon], {color: f.color, radius: 6}).addTo(layers);
                const item = document.createElement('div');
                item.className = `card ${f.color}`;
                item.innerHTML = `<b>${f.id}</b> - ${f.status}<br>ALT: ${Math.round(f.alt)}m`;
                list.appendChild(item);
            });
        }

        function filter(c) {
            const desc = {
                all: "Showing all flights.", red: "Collision hazard detected.",
                green: "Flights on final landing approach.", white: "Flights in departure climb.",
                blue: "Ready for pattern entry.", purple: "Mechanical/Emergency (Squawk 7700)."
            };
            document.getElementById('status-info').innerText = desc[c];
            render(c === 'all' ? allData : allData.filter(f => f.color === c));
        }

        setInterval(sync, 30000); sync();
    </script>
</body>
</html>
