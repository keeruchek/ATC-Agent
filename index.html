<!DOCTYPE html>
<html>
<head>
    <title>AI ATC Radar</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { background: #0b132b; color: white; font-family: monospace; display: flex; margin: 0; }
        #map { height: 100vh; width: 75%; }
        #sidebar { width: 25%; padding: 20px; overflow-y: auto; background: #1c2541; }
        .flight-item { padding: 10px; border-bottom: 1px solid #3a506b; }
        .red { color: #ff4d4d; } .yellow { color: #ffcc00; } .purple { color: #cc33ff; }
        .blue { color: #33ccff; } .green { color: #33ff33; } .white { color: #ffffff; }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="sidebar">
        <h2>AI ATC AGENT</h2>
        <div id="flight-list">Scanning...</div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const map = L.map('map').setView([40.6413, -73.7781], 10);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

        async function updateRadar() {
            const response = await fetch('data.json');
            const data = await response.json();
            
            document.getElementById('flight-list').innerHTML = '';
            data.flights.forEach(f => {
                // Draw plane on map
                L.circleMarker([f.lat, f.lon], { color: f.color, radius: 8 }).addTo(map)
                    .bindPopup(`ID: ${f.id}<br>Status: ${f.status}`);

                // Update Sidebar
                const div = document.createElement('div');
                div.className = `flight-item ${f.color}`;
                div.innerHTML = `<b>${f.id}</b> - ${f.status} <br> Alt: ${f.alt}m`;
                document.getElementById('flight-list').appendChild(div);

                // AI Voice Command
                if (f.command) {
                    const speech = new SpeechSynthesisUtterance(f.command);
                    window.speechSynthesis.speak(speech);
                }
            });
        }
        setInterval(updateRadar, 30000); // Check for cloud updates every 30s
        updateRadar();
    </script>
</body>
</html>
